<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pendinha Boss Shooter</title>

<style>
* { box-sizing: border-box; }

html, body {
  margin: 0;
  padding: 0;
  background: #000;
  overflow: hidden;
  font-family: Arial, Helvetica, sans-serif;
  color: #fff;
}

#gameContainer {
  position: relative;
  max-width: 420px;
  margin: auto;
}

canvas {
  width: 100%;
  display: block;
  background: radial-gradient(#111, #000);
}

#ui {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 14px;
  z-index: 10;
}

#menu {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

#menu button {
  padding: 10px 26px;
  font-size: 16px;
  background: #00e5ff;
  border: none;
  cursor: pointer;
}
</style>
</head>

<body>

<div id="gameContainer">
  <canvas id="game" width="360" height="520"></canvas>

  <div id="ui">
    Fase: <span id="phase">1</span><br>
    Score: <span id="score">0</span>
  </div>

  <div id="menu">
    <h1>üëæ Pendinha Boss Shooter</h1>
    <button id="startBtn">‚ñ∂ Iniciar</button>
  </div>
</div>

<script>
/* ========================= BASE ========================= */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const W = canvas.width;
const H = canvas.height;

const STATE = { MENU:0, PLAYING:1, GAMEOVER:2 };
let gameState = STATE.MENU;

let score = 0;
let phase = 1;

/* ========================= INPUT ========================= */

const input = { x: W/2, y: H-80, down:false };

canvas.addEventListener("mousemove", e=>{
  const r = canvas.getBoundingClientRect();
  input.x = (e.clientX - r.left) * (W / r.width);
  input.y = (e.clientY - r.top) * (H / r.height);
});
canvas.addEventListener("mousedown",()=>input.down=true);
canvas.addEventListener("mouseup",()=>input.down=false);

/* ========================= PLAYER ========================= */

const player = {
  x: W/2,
  y: H-60,
  size: 16,
  cooldown: 0,
  bullets: []
};

function shootPlayer(){
  player.bullets.push({
    x: player.x,
    y: player.y - 12,
    vy: -7,
    r: 3
  });
}

/* ========================= BOSS (NAVE-M√ÉE) ========================= */

const boss = {
  x: W/2,
  y: 90,
  radius: 32,
  life: 200,
  maxLife: 200,
  shootTimer: 0,
  bullets: []
};

function bossShoot(){
  for(let i=-2;i<=2;i++){
    boss.bullets.push({
      x: boss.x,
      y: boss.y,
      angle: Math.PI/2 + i*0.25,
      speed: 2.2,
      r: 5
    });
  }
}

/* ========================= UPDATE ========================= */

function update(){

  if(gameState !== STATE.PLAYING) return;

  /* PLAYER */
  player.x += (input.x - player.x) * 0.15;
  player.y += (input.y - player.y) * 0.15;
  player.cooldown--;

  if(input.down && player.cooldown<=0){
    shootPlayer();
    player.cooldown = 12;
  }

  player.bullets.forEach(b => b.y += b.vy);
  player.bullets = player.bullets.filter(b => b.y > -20);

  /* BOSS */
  boss.shootTimer++;
  if(boss.shootTimer > 60){
    boss.shootTimer = 0;
    bossShoot();
  }

  boss.bullets.forEach(b=>{
    b.x += Math.cos(b.angle)*b.speed;
    b.y += Math.sin(b.angle)*b.speed;
  });

  boss.bullets = boss.bullets.filter(
    b => b.x>-40 && b.x<W+40 && b.y>-40 && b.y<H+40
  );

  /* COLLIS√ÉO PLAYER ‚Üê BOSS */
  boss.bullets.forEach(b=>{
    if(Math.hypot(player.x-b.x, player.y-b.y) < player.size + b.r){
      gameState = STATE.GAMEOVER;
      document.getElementById("menu").style.display="flex";
      document.querySelector("#menu h1").textContent="üíÄ GAME OVER";
    }
  });

  document.getElementById("score").textContent = score;
  document.getElementById("phase").textContent = phase;
}

/* ========================= DRAW ========================= */

function render(){

  ctx.clearRect(0,0,W,H);

  /* BOSS */
  ctx.fillStyle="#b71c1c";
  ctx.beginPath();
  ctx.arc(boss.x,boss.y,boss.radius,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="#ff5252";
  ctx.beginPath();
  ctx.arc(boss.x,boss.y,10,0,Math.PI*2);
  ctx.fill();

  /* BOSS BULLETS */
  ctx.fillStyle="#ff1744";
  boss.bullets.forEach(b=>{
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  });

  if(gameState === STATE.PLAYING){
    /* PLAYER */
    ctx.fillStyle="#00e5ff";
    ctx.beginPath();
    ctx.moveTo(player.x,player.y-12);
    ctx.lineTo(player.x-10,player.y+10);
    ctx.lineTo(player.x+10,player.y+10);
    ctx.fill();

    /* PLAYER BULLETS */
    player.bullets.forEach(b=>{
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
      ctx.fill();
    });
  }
}

/* ========================= LOOP ========================= */

function loop(){
  update();
  render();
  requestAnimationFrame(loop);
}
loop();

/* ========================= START ========================= */

document.getElementById("startBtn").onclick = ()=>{
  score=0;
  phase=1;
  player.bullets=[];
  boss.bullets=[];
  boss.life=boss.maxLife;
  gameState=STATE.PLAYING;
  document.getElementById("menu").style.display="none";
};
</script>

</body>
</html>
<script>
/* ============================================================
   PARTE 2 ‚Äî INIMIGOS PEQUENOS (TRI√ÇNGULOS)
   ============================================================ */

/* ---------- INIMIGOS ---------- */

const enemies = [];

const ENEMY_TYPES = {
  SMALL: { size: 12, life: 1, speed: 1.6, score: 10 },
  MEDIUM:{ size: 18, life: 3, speed: 1.1, score: 30 }
};

let enemySpawnTimer = 0;

/* ---------- SPAWN ---------- */

function spawnEnemy(){
  const t = Math.random() < 0.7 ? ENEMY_TYPES.SMALL : ENEMY_TYPES.MEDIUM;

  enemies.push({
    x: Math.random() * (W - 40) + 20,
    y: -30,
    vx: (Math.random() - 0.5) * 1.2,
    vy: t.speed,
    size: t.size,
    life: t.life,
    score: t.score
  });
}

/* ---------- UPDATE INIMIGOS ---------- */

function updateEnemies(){

  enemySpawnTimer++;
  const spawnRate = Math.max(50 - phase * 2, 20);

  if(enemySpawnTimer > spawnRate){
    enemySpawnTimer = 0;
    spawnEnemy();
  }

  for(let i = enemies.length - 1; i >= 0; i--){
    const e = enemies[i];

    e.x += e.vx;
    e.y += e.vy;

    /* Saiu da tela */
    if(e.y > H + 40){
      enemies.splice(i,1);
      continue;
    }

    /* Colis√£o com player */
    if(Math.hypot(player.x - e.x, player.y - e.y) < player.size + e.size){
      gameState = STATE.GAMEOVER;
      document.getElementById("menu").style.display="flex";
      document.querySelector("#menu h1").textContent="üíÄ GAME OVER";
      return;
    }

    /* Colis√£o com tiros do player */
    for(let j = player.bullets.length - 1; j >= 0; j--){
      const b = player.bullets[j];
      if(Math.hypot(b.x - e.x, b.y - e.y) < e.size){
        e.life--;
        player.bullets.splice(j,1);

        if(e.life <= 0){
          score += e.score;
          enemies.splice(i,1);
        }
        break;
      }
    }
  }
}

/* ---------- DRAW INIMIGOS ---------- */

function drawEnemies(){

  enemies.forEach(e=>{
    ctx.fillStyle = e.life === 1 ? "#ffeb3b" : "#ff9800";

    ctx.beginPath();
    ctx.moveTo(e.x, e.y - e.size);
    ctx.lineTo(e.x - e.size, e.y + e.size);
    ctx.lineTo(e.x + e.size, e.y + e.size);
    ctx.closePath();
    ctx.fill();

    /* n√∫cleo */
    ctx.fillStyle="#000";
    ctx.beginPath();
    ctx.arc(e.x, e.y + 2, 3, 0, Math.PI*2);
    ctx.fill();
  });
}

/* ============================================================
   INTEGRA√á√ÉO SEGURA COM ENGINE EXISTENTE
   ============================================================ */

const __update_part2 = update;
update = function(){
  if(gameState === STATE.PLAYING){
    updateEnemies();
  }
  __update_part2();
};

const __render_part2 = render;
render = function(){
  __render_part2();
  if(gameState === STATE.PLAYING){
    drawEnemies();
  }
};
</script>
<script>
/* ============================================================
   PARTE 3 ‚Äî INIMIGOS ATIRADORES (NAVES M√âDIAS)
   ============================================================ */

/* ---------- ENEMIGOS ATIRADORES ---------- */

const shooterEnemies = [];
let shooterSpawnTimer = 0;

/* ---------- SPAWN ---------- */

function spawnShooterEnemy(){
  shooterEnemies.push({
    x: Math.random() * (W - 60) + 30,
    y: -40,
    size: 18,
    life: 3,
    vy: 1.2,
    shootTimer: 0,
    bullets: []
  });
}

/* ---------- UPDATE ATIRADORES ---------- */

function updateShooterEnemies(){

  shooterSpawnTimer++;
  const spawnRate = Math.max(260 - phase * 10, 120);

  if(shooterSpawnTimer > spawnRate){
    shooterSpawnTimer = 0;
    spawnShooterEnemy();
  }

  for(let i = shooterEnemies.length - 1; i >= 0; i--){
    const e = shooterEnemies[i];

    e.y += e.vy;
    e.shootTimer++;

    /* Saiu da tela */
    if(e.y > H + 50){
      shooterEnemies.splice(i,1);
      continue;
    }

    /* Disparo */
    if(e.shootTimer > 60){
      e.shootTimer = 0;

      e.bullets.push({
        x: e.x,
        y: e.y,
        angle: Math.PI / 2,
        speed: 2.4 + phase * 0.08,
        radius: 4
      });
    }

    /* Update tiros */
    for(let j = e.bullets.length - 1; j >= 0; j--){
      const b = e.bullets[j];
      b.x += Math.cos(b.angle) * b.speed;
      b.y += Math.sin(b.angle) * b.speed;

      /* Colis√£o com player */
      if(Math.hypot(player.x - b.x, player.y - b.y) < player.size + b.radius){
        gameState = STATE.GAMEOVER;
        document.getElementById("menu").style.display="flex";
        document.querySelector("#menu h1").textContent="üíÄ GAME OVER";
        return;
      }

      if(b.y > H + 20){
        e.bullets.splice(j,1);
      }
    }

    /* Colis√£o com tiros do player */
    for(let j = player.bullets.length - 1; j >= 0; j--){
      const b = player.bullets[j];
      if(Math.hypot(b.x - e.x, b.y - e.y) < e.size){
        e.life--;
        player.bullets.splice(j,1);

        if(e.life <= 0){
          score += 40;
          shooterEnemies.splice(i,1);
        }
        break;
      }
    }
  }
}

/* ---------- DRAW ATIRADORES ---------- */

function drawShooterEnemies(){

  shooterEnemies.forEach(e=>{

    /* Corpo */
    ctx.fillStyle="#f44336";
    ctx.fillRect(e.x - 12, e.y - 12, 24, 24);

    /* N√∫cleo */
    ctx.fillStyle="#ffcdd2";
    ctx.beginPath();
    ctx.arc(e.x, e.y, 4, 0, Math.PI*2);
    ctx.fill();

    /* Tiros */
    ctx.fillStyle="#ff5252";
    e.bullets.forEach(b=>{
      ctx.beginPath();
      ctx.arc(b.x, b.y, b.radius, 0, Math.PI*2);
      ctx.fill();
    });
  });
}

/* ============================================================
   INTEGRA√á√ÉO SEGURA
   ============================================================ */

const __update_part3 = update;
update = function(){
  if(gameState === STATE.PLAYING){
    updateShooterEnemies();
  }
  __update_part3();
};

const __render_part3 = render;
render = function(){
  __render_part3();
  if(gameState === STATE.PLAYING){
    drawShooterEnemies();
  }
};
</script>
<script>
/* ============================================================
   PARTE 4 ‚Äî SISTEMA DE ARMAS & POWER-UPS
   ============================================================ */

/* ---------- TIPOS DE ARMAS ---------- */

const WEAPONS = {
  BASIC: "basic",
  DOUBLE: "double",
  SPREAD: "spread",
  RAPID: "rapid"
};

let currentWeapon = WEAPONS.BASIC;
let weaponTimer = 0;

/* ---------- POWER-UPS ---------- */

const powerUps = [];

/* ---------- SPAWN POWER-UP ---------- */

function spawnPowerUp(x, y){
  const types = Object.values(WEAPONS);
  powerUps.push({
    x,
    y,
    type: types[Math.floor(Math.random() * types.length)],
    radius: 10,
    vy: 1.2
  });
}

/* ---------- UPDATE POWER-UPS ---------- */

function updatePowerUps(){

  for(let i = powerUps.length - 1; i >= 0; i--){
    const p = powerUps[i];
    p.y += p.vy;

    if(p.y > H + 20){
      powerUps.splice(i,1);
      continue;
    }

    /* Coleta */
    if(Math.hypot(player.x - p.x, player.y - p.y) < player.size + p.radius){
      activatePowerUp(p.type);
      powerUps.splice(i,1);
    }
  }
}

/* ---------- ATIVA POWER-UP ---------- */

function activatePowerUp(type){
  currentWeapon = type;
  weaponTimer = 600; // dura√ß√£o
}

/* ---------- OVERRIDE SHOOT PLAYER ---------- */

const __shootPlayer_base = shootPlayer;
shootPlayer = function(){

  if(currentWeapon === WEAPONS.BASIC){
    __shootPlayer_base();
  }

  if(currentWeapon === WEAPONS.DOUBLE){
    player.bullets.push(
      { x: player.x - 6, y: player.y, speed: 7, radius: 3 },
      { x: player.x + 6, y: player.y, speed: 7, radius: 3 }
    );
  }

  if(currentWeapon === WEAPONS.SPREAD){
    [-0.3, 0, 0.3].forEach(a=>{
      player.bullets.push({
        x: player.x,
        y: player.y,
        speed: 6,
        angle: -Math.PI/2 + a,
        radius: 3
      });
    });
  }

  if(currentWeapon === WEAPONS.RAPID){
    player.bullets.push({
      x: player.x,
      y: player.y,
      speed: 9,
      radius: 2
    });
  }
};

/* ---------- UPDATE ARMAS ---------- */

const __update_part4 = update;
update = function(){

  if(gameState === STATE.PLAYING){

    updatePowerUps();

    if(weaponTimer > 0){
      weaponTimer--;
      if(weaponTimer === 0){
        currentWeapon = WEAPONS.BASIC;
      }
    }
  }

  __update_part4();
};

/* ---------- DRAW POWER-UPS ---------- */

function drawPowerUps(){

  powerUps.forEach(p=>{
    ctx.fillStyle="#00e676";
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, Math.PI*2);
    ctx.fill();

    ctx.fillStyle="#000";
    ctx.font="10px Arial";
    ctx.fillText(p.type[0].toUpperCase(), p.x - 3, p.y + 4);
  });
}

/* ---------- INTEGRA√á√ÉO DRAW ---------- */

const __render_part4 = render;
render = function(){

  __render_part4();

  if(gameState === STATE.PLAYING){
    drawPowerUps();
  }
};

/* ============================================================
   DROP DE POWER-UP AO MATAR INIMIGOS
   ============================================================ */

/* Hook nos inimigos normais */
const __updateEnemies_drop = updateEnemies;
updateEnemies = function(){
  __updateEnemies_drop();

  enemies.forEach((e,i)=>{
    if(e.life <= 0){
      if(Math.random() < 0.15){
        spawnPowerUp(e.x, e.y);
      }
    }
  });
};

/* Hook nos atiradores */
const __updateShooters_drop = updateShooterEnemies;
updateShooterEnemies = function(){
  __updateShooters_drop();

  shooterEnemies.forEach((e,i)=>{
    if(e.life <= 0){
      if(Math.random() < 0.25){
        spawnPowerUp(e.x, e.y);
      }
    }
  });
};
</script>
