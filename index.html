<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pendinha Boss Shooter</title>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;padding:0;
  background:#000;
  font-family:Arial,Helvetica,sans-serif;
  color:#fff;
  overflow:hidden
}
#gameContainer{
  max-width:420px;
  margin:0 auto;
  position:relative
}
canvas{
  width:100%;
  display:block;
  background:#000
}
#ui{
  position:absolute;
  top:10px;
  left:10px;
  font-size:14px;
  z-index:10
}
#menu{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.85);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:20
}
button{
  padding:12px 28px;
  font-size:16px;
  cursor:pointer
}
</style>
</head>

<body>

<div id="gameContainer">
  <canvas id="game" width="360" height="520"></canvas>

  <div id="ui">
    Fase: <span id="phase">1</span><br>
    Score: <span id="score">0</span>
  </div>

  <div id="menu">
    <h1>ðŸ‘¾ Pendinha Boss Shooter</h1>
    <p>Desvie. Atire. Sobreviva.</p>
    <button id="startBtn">â–¶ Iniciar</button>
  </div>
</div>

<script>
/* ===================== CANVAS ===================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const W = canvas.width;
const H = canvas.height;

/* ===================== STATE ===================== */
let playing = false;
let score = 0;
let phase = 1;

/* ===================== INPUT ===================== */
let mouseX = W/2;
let mouseY = H-80;
let mouseDown = false;

canvas.addEventListener("mousemove",e=>{
  const r = canvas.getBoundingClientRect();
  mouseX = (e.clientX - r.left) * (W / r.width);
  mouseY = (e.clientY - r.top)  * (H / r.height);
});
canvas.addEventListener("mousedown",()=>mouseDown=true);
canvas.addEventListener("mouseup",()=>mouseDown=false);

/* ===================== PLAYER ===================== */
const player = {
  x: W/2,
  y: H-70,
  bullets: [],
  cooldown: 0
};

/* ===================== BOSS ===================== */
const boss = {
  x: W/2,
  y: 90,
  radius: 32,
  life: 100,
  maxLife: 100,
  bullets: [],
  timer: 0,
  pattern: 0
};

/* ===================== START ===================== */
document.getElementById("startBtn").onclick = ()=>{
  playing = true;
  score = 0;
  phase = 1;
  resetBoss();
  player.bullets = [];
  boss.bullets = [];
  document.getElementById("menu").style.display="none";
};

/* ===================== RESET BOSS ===================== */
function resetBoss(){
  boss.x = W/2;
  boss.y = 90;
  boss.maxLife = 100 + phase * 40;
  boss.life = boss.maxLife;
  boss.timer = 0;
  boss.pattern = phase % 3;
  boss.bullets = [];
}

/* ===================== LOOP ===================== */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

/* ===================== UPDATE ===================== */
function update(){
  if(!playing) return;

  /* ---- PLAYER ---- */
  player.x += (mouseX - player.x) * 0.25;
  player.y += (mouseY - player.y) * 0.25;

  player.x = Math.max(15,Math.min(W-15,player.x));
  player.y = Math.max(H/2,Math.min(H-15,player.y));

  if(player.cooldown>0) player.cooldown--;

  if(mouseDown && player.cooldown===0){
    player.bullets.push({
      x: player.x,
      y: player.y,
      vy: -7
    });
    player.cooldown = 12;
  }

  player.bullets.forEach(b=>b.y+=b.vy);
  player.bullets = player.bullets.filter(b=>b.y>-10);

  /* ---- BOSS ---- */
  boss.timer++;
  const delay = Math.max(50 - phase*3, 15);
  if(boss.timer > delay){
    boss.timer = 0;
    shootBoss();
  }

  boss.bullets.forEach(b=>{
    b.x += b.vx;
    b.y += b.vy;
  });
  boss.bullets = boss.bullets.filter(
    b=>b.x>-30 && b.x<W+30 && b.y<H+30
  );

  /* ---- COLLISIONS ---- */
  // player -> boss
  player.bullets.forEach((b,i)=>{
    if(Math.hypot(b.x-boss.x,b.y-boss.y)<boss.radius){
      boss.life -= 10;
      player.bullets.splice(i,1);
      score += 10;
    }
  });

  // boss -> player
  boss.bullets.forEach(b=>{
    if(Math.hypot(b.x-player.x,b.y-player.y)<12){
      gameOver();
    }
  });

  if(boss.life<=0){
    phase++;
    score += 100;
    resetBoss();
  }

  document.getElementById("score").textContent = score;
  document.getElementById("phase").textContent = phase;
}

/* ===================== BOSS PATTERNS ===================== */
function shootBoss(){

  const spd = 2 + phase*0.15;

  // padrÃ£o 0 â€“ triplo reto
  if(boss.pattern===0){
    [-0.25,0,0.25].forEach(a=>{
      boss.bullets.push({
        x: boss.x,
        y: boss.y,
        vx: Math.sin(a)*spd,
        vy: Math.cos(a)*spd
      });
    });
  }

  // padrÃ£o 1 â€“ leque
  if(boss.pattern===1){
    for(let i=-4;i<=4;i++){
      boss.bullets.push({
        x: boss.x,
        y: boss.y,
        vx: Math.sin(i*0.18)*spd,
        vy: Math.cos(i*0.18)*spd
      });
    }
  }

  // padrÃ£o 2 â€“ espiral
  if(boss.pattern===2){
    for(let i=0;i<6;i++){
      const ang = boss.timer*0.15 + i;
      boss.bullets.push({
        x: boss.x,
        y: boss.y,
        vx: Math.cos(ang)*spd,
        vy: Math.sin(ang)*spd
      });
    }
  }
}

/* ===================== GAME OVER ===================== */
function gameOver(){
  playing = false;
  document.getElementById("menu").style.display="flex";
}

/* ===================== DRAW ===================== */
function draw(){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,W,H);

  if(!playing) return;

  // fundo animado simples
  ctx.fillStyle="rgba(255,255,255,0.04)";
  for(let i=0;i<20;i++){
    ctx.beginPath();
    ctx.arc(
      (i*40 + Date.now()*0.03)%W,
      (i*70)%H,
      18,0,Math.PI*2
    );
    ctx.fill();
  }

  // player
  ctx.fillStyle="#00e5ff";
  ctx.beginPath();
  ctx.moveTo(player.x,player.y-12);
  ctx.lineTo(player.x-10,player.y+10);
  ctx.lineTo(player.x+10,player.y+10);
  ctx.fill();

  // player bullets
  ctx.fillStyle="#00e5ff";
  player.bullets.forEach(b=>{
    ctx.beginPath();
    ctx.arc(b.x,b.y,3,0,Math.PI*2);
    ctx.fill();
  });

  // boss
  ctx.fillStyle="#b71c1c";
  ctx.beginPath();
  ctx.arc(boss.x,boss.y,boss.radius,0,Math.PI*2);
  ctx.fill();

  // boss bullets
  ctx.fillStyle="#ff5252";
  boss.bullets.forEach(b=>{
    ctx.beginPath();
    ctx.arc(b.x,b.y,5,0,Math.PI*2);
    ctx.fill();
  });

  // boss life bar
  ctx.fillStyle="#fff";
  ctx.fillRect(boss.x-40,boss.y-50,80,6);
  ctx.fillStyle="#e53935";
  ctx.fillRect(
    boss.x-40,boss.y-50,
    80*(boss.life/boss.maxLife),6
  );
}
</script>

</body>
</html>
