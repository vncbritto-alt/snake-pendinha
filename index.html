<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cobrinha Pendinha</title>

<style>
/* ============================================================
   ======================= RESET ==============================
   ============================================================ */

* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  background: #000;
  font-family: Arial, Helvetica, sans-serif;
  overflow: hidden;
}

/* ============================================================
   ==================== CONTAINER =============================
   ============================================================ */

#gameContainer {
  position: relative;
  width: 100%;
  max-width: 520px;
  margin: 0 auto;
}

/* ============================================================
   ======================= CANVAS =============================
   ============================================================ */

canvas {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 14px;
  background: #0b1d13;
}

/* ============================================================
   ========================= UI ===============================
   ============================================================ */

#ui {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 20;
  color: #fff;
  font-size: 16px;
  line-height: 1.4;
  pointer-events: none;
}

/* ============================================================
   ===================== FULLSCREEN ===========================
   ============================================================ */

#fullscreenBtn {
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 30;
  background: rgba(0,0,0,0.6);
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 6px 10px;
  cursor: pointer;
  font-size: 18px;
}

/* ============================================================
   ========================= MENU =============================
   ============================================================ */

#menu {
  position: absolute;
  inset: 0;
  z-index: 40;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.75);
  color: #fff;
}

#menu h2 {
  margin: 0 0 10px 0;
}

#menu p {
  margin: 6px 0;
}

.colorPicker {
  display: flex;
  gap: 10px;
  margin: 12px 0;
}

.color {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid #fff;
}

.color.selected {
  outline: 3px solid #00e676;
}

#startBtn {
  margin-top: 16px;
  padding: 10px 26px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: #00e676;
  color: #000;
}
</style>
</head>

<body>

<div id="gameContainer">

  <button id="fullscreenBtn">‚õ∂</button>

  <canvas id="game" width="360" height="520"></canvas>

  <div id="ui">
    Pontos: <span id="score">0</span><br>
    Fase: <span id="phase">1</span>
  </div>

  <div id="menu">
    <h2>üêç Cobrinha Pendinha</h2>
    <p>Escolha a cor da cobra</p>
    <div class="colorPicker" id="colors"></div>
    <button id="startBtn">‚ñ∂ Iniciar Jogo</button>
  </div>

</div>

<script>
/* ============================================================
   ====================== ENGINE BASE =========================
   ============================================================ */

/* ---------- Canvas ---------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const BASE_WIDTH  = 360;
const BASE_HEIGHT = 520;

canvas.width  = BASE_WIDTH;
canvas.height = BASE_HEIGHT;

/* ---------- Estados ---------- */
const GAME_STATE = {
  MENU: "menu",
  PLAYING: "playing",
  GAMEOVER: "gameover"
};

let currentState = GAME_STATE.MENU;

/* ---------- Tempo ---------- */
let lastTime = 0;
let deltaTime = 0;

/* ============================================================
   ====================== CONFIG GERAL ========================
   ============================================================ */

const COLORS = [
  "#4caf50",
  "#ff5722",
  "#2196f3",
  "#e91e63",
  "#9c27b0",
  "#ffeb3b",
  "#00bcd4",
  "#8bc34a",
  "#ff9800",
  "#795548"
];

let selectedColor = COLORS[0];

let score = 0;
let phase = 1;
const MAX_PHASE = 20;

/* ============================================================
   ====================== INPUT SYSTEM ========================
   ============================================================ */

const input = {
  mouseX: 0,
  mouseY: 0,
  mouseDown: false
};

canvas.addEventListener("mousemove", e => {
  const rect = canvas.getBoundingClientRect();
  input.mouseX = (e.clientX - rect.left) * (BASE_WIDTH / rect.width);
  input.mouseY = (e.clientY - rect.top)  * (BASE_HEIGHT / rect.height);
});

canvas.addEventListener("mousedown", () => {
  input.mouseDown = true;
});

canvas.addEventListener("mouseup", () => {
  input.mouseDown = false;
});

/* ============================================================
   ====================== FULLSCREEN ==========================
   ============================================================ */

document.getElementById("fullscreenBtn").onclick = () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
};

/* ============================================================
   ====================== MENU LOGIC ==========================
   ============================================================ */

const colorsDiv = document.getElementById("colors");
const menuDiv   = document.getElementById("menu");
const startBtn  = document.getElementById("startBtn");

COLORS.forEach(color => {
  const d = document.createElement("div");
  d.className = "color";
  d.style.background = color;
  if (color === selectedColor) d.classList.add("selected");

  d.onclick = () => {
    selectedColor = color;
    document.querySelectorAll(".color").forEach(c => c.classList.remove("selected"));
    d.classList.add("selected");
  };

  colorsDiv.appendChild(d);
});

startBtn.onclick = () => {
  startGame();
};

/* ============================================================
   ====================== GAME START ==========================
   ============================================================ */

function startGame() {
  score = 0;
  phase = 1;
  updateUI();

  currentState = GAME_STATE.PLAYING;
  menuDiv.style.display = "none";

  // Inicializa√ß√µes completas vir√£o na PARTE 2+
}

/* ============================================================
   ====================== UI UPDATE ===========================
   ============================================================ */

function updateUI() {
  document.getElementById("score").textContent = score;
  document.getElementById("phase").textContent = phase;
}

/* ============================================================
   ====================== LOOP PRINCIPAL ======================
   ============================================================ */

function gameLoop(timestamp) {

  deltaTime = timestamp - lastTime;
  lastTime = timestamp;

  update(deltaTime);
  draw();

  requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);

/* ============================================================
   ====================== UPDATE ==============================
   ============================================================ */

function update(dt) {

  if (currentState === GAME_STATE.MENU) {
    // Nada aqui por enquanto
  }

  if (currentState === GAME_STATE.PLAYING) {
    // L√≥gica pesada entra na PARTE 2
  }

  if (currentState === GAME_STATE.GAMEOVER) {
    // Tratado depois
  }
}

/* ============================================================
   ====================== DRAW ================================
   ============================================================ */

function draw() {

  // Fundo base (vai virar din√¢mico depois)
  ctx.fillStyle = "#0b1d13";
  ctx.fillRect(0, 0, BASE_WIDTH, BASE_HEIGHT);

  if (currentState === GAME_STATE.MENU) {
    drawMenuPreview();
  }

  if (currentState === GAME_STATE.PLAYING) {
    // Render completo entra na PARTE 2
  }
}

/* ============================================================
   ====================== MENU PREVIEW ========================
   ============================================================ */

function drawMenuPreview() {
  ctx.fillStyle = "#1e3d2b";
  ctx.beginPath();
  ctx.arc(
    BASE_WIDTH / 2,
    BASE_HEIGHT / 2,
    60 + Math.sin(Date.now() * 0.003) * 6,
    0,
    Math.PI * 2
  );
  ctx.fill();
}
</script>

</body>
</html>
<script>
/* ============================================================
   ===================== PLAYER SNAKE =========================
   ============================================================ */

const snake = {
  x: BASE_WIDTH / 2,
  y: BASE_HEIGHT / 2,
  angle: 0,
  speed: 2.2,
  length: 14,
  body: [],
  eyeBlink: 0,
  tongueTime: 0
};

/* ============================================================
   ===================== BACKGROUND ===========================
   ============================================================ */

let bgOffset = 0;

const backgrounds = [
  { sky: "#0b1d13", dots: "rgba(255,255,255,0.05)" },
  { sky: "#1b263b", dots: "rgba(255,255,255,0.08)" },
  { sky: "#2e1f27", dots: "rgba(255,200,200,0.08)" },
  { sky: "#102027", dots: "rgba(200,255,255,0.08)" },
  { sky: "#1b5e20", dots: "rgba(200,255,200,0.08)" }
];

/* ============================================================
   ===================== GAME RESET ===========================
   ============================================================ */

function resetSnake() {
  snake.x = BASE_WIDTH / 2;
  snake.y = BASE_HEIGHT / 2;
  snake.angle = 0;
  snake.length = 14;
  snake.body = [];
  snake.eyeBlink = 0;
  snake.tongueTime = 0;
}

/* ============================================================
   ===================== UPDATE (PLAYING) =====================
   ============================================================ */

function updatePlaying(dt) {

  bgOffset += 0.25;

  /* ---------- Dire√ß√£o pelo mouse ---------- */
  snake.angle = Math.atan2(
    input.mouseY - snake.y,
    input.mouseX - snake.x
  );

  /* ---------- Movimento ---------- */
  snake.x += Math.cos(snake.angle) * snake.speed;
  snake.y += Math.sin(snake.angle) * snake.speed;

  /* ---------- Limites da tela ---------- */
  snake.x = Math.max(10, Math.min(BASE_WIDTH - 10, snake.x));
  snake.y = Math.max(10, Math.min(BASE_HEIGHT - 10, snake.y));

  /* ---------- Corpo ---------- */
  snake.body.unshift({ x: snake.x, y: snake.y });
  if (snake.body.length > snake.length) {
    snake.body.pop();
  }

  /* ---------- Olhos piscando ---------- */
  snake.eyeBlink++;
  if (snake.eyeBlink > 240) snake.eyeBlink = 0;

  /* ---------- L√≠ngua ---------- */
  snake.tongueTime += 0.12;
}

/* ============================================================
   ===================== DRAW BACKGROUND ======================
   ============================================================ */

function drawBackground() {

  const bg = backgrounds[(phase - 1) % backgrounds.length];

  ctx.fillStyle = bg.sky;
  ctx.fillRect(0, 0, BASE_WIDTH, BASE_HEIGHT);

  ctx.fillStyle = bg.dots;

  for (let i = 0; i < 25; i++) {
    ctx.beginPath();
    ctx.arc(
      (i * 40 + bgOffset) % BASE_WIDTH,
      (i * 30 + bgOffset * 0.6) % BASE_HEIGHT,
      18,
      0,
      Math.PI * 2
    );
    ctx.fill();
  }
}

/* ============================================================
   ===================== DRAW SNAKE ===========================
   ============================================================ */

function drawSnake() {

  /* ---------- Corpo ---------- */
  ctx.fillStyle = selectedColor;
  snake.body.forEach((p, i) => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, 8 - i * 0.04, 0, Math.PI * 2);
    ctx.fill();
  });

  /* ---------- Cabe√ßa ---------- */
  ctx.beginPath();
  ctx.arc(snake.x, snake.y, 10, 0, Math.PI * 2);
  ctx.fill();

  /* ---------- Olhos ---------- */
  if (snake.eyeBlink < 200) {
    ctx.fillStyle = "#000";
    ctx.beginPath();
    ctx.arc(
      snake.x + Math.cos(snake.angle + 0.5) * 5,
      snake.y + Math.sin(snake.angle + 0.5) * 5,
      2,
      0,
      Math.PI * 2
    );
    ctx.arc(
      snake.x + Math.cos(snake.angle - 0.5) * 5,
      snake.y + Math.sin(snake.angle - 0.5) * 5,
      2,
      0,
      Math.PI * 2
    );
    ctx.fill();
  }

  /* ---------- L√≠ngua ---------- */
  ctx.strokeStyle = "#ff1744";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(snake.x, snake.y);
  ctx.lineTo(
    snake.x + Math.cos(snake.angle) * (10 + Math.sin(snake.tongueTime) * 6),
    snake.y + Math.sin(snake.angle) * (10 + Math.sin(snake.tongueTime) * 6)
  );
  ctx.stroke();
}

/* ============================================================
   ===================== LOOP INTEGRATION =====================
   ============================================================ */

/* Substitui comportamento do update/draw da Parte 1 */

const originalUpdate = update;
const originalDraw   = draw;

update = function(dt) {

  if (currentState === GAME_STATE.PLAYING) {
    updatePlaying(dt);
  }

  originalUpdate(dt);
};

draw = function() {

  drawBackground();

  if (currentState === GAME_STATE.MENU) {
    drawMenuPreview();
  }

  if (currentState === GAME_STATE.PLAYING) {
    drawSnake();
  }
};
</script>
<script>
/* ============================================================
   ===================== FOOD SYSTEM ==========================
   ============================================================ */

let food = null;

function spawnFood() {
  food = {
    x: Math.random() * (BASE_WIDTH - 60) + 30,
    y: Math.random() * (BASE_HEIGHT - 60) + 30,
    angle: Math.random() * Math.PI * 2,
    speed: 1.2,
    radius: 6
  };
}

/* ============================================================
   ===================== ENEMY SNAKES =========================
   ============================================================ */

const enemySnakes = [];

function spawnEnemySnake() {
  const size = Math.floor(Math.random() * 4) + 2; // 2 a 5

  enemySnakes.push({
    x: Math.random() * (BASE_WIDTH - 80) + 40,
    y: Math.random() * (BASE_HEIGHT - 80) + 40,
    angle: Math.random() * Math.PI * 2,
    speed: 0.9 + Math.random() * 0.4,
    size,
    length: size * 8,
    body: []
  });
}

/* ============================================================
   ===================== PLAYER SHOTS =========================
   ============================================================ */

const playerShots = [];

function shootPlayer() {
  playerShots.push({
    x: snake.x,
    y: snake.y,
    angle: snake.angle,
    speed: 6,
    radius: 4
  });
}

/* ============================================================
   ===================== INPUT EXTENSION ======================
   ============================================================ */

canvas.addEventListener("mousedown", () => {
  if (currentState !== GAME_STATE.PLAYING) return;
  shootPlayer();
});

/* ============================================================
   ===================== UPDATE FOOD ==========================
   ============================================================ */

function updateFood() {
  if (!food) return;

  food.angle += (Math.random() - 0.5) * 0.15;
  food.x += Math.cos(food.angle) * food.speed;
  food.y += Math.sin(food.angle) * food.speed;

  food.x = Math.max(20, Math.min(BASE_WIDTH - 20, food.x));
  food.y = Math.max(20, Math.min(BASE_HEIGHT - 20, food.y));

  const d = Math.hypot(snake.x - food.x, snake.y - food.y);
  if (d < 16) {
    snake.length += 4;
    score += 1;
    updateUI();
    spawnFood();

    if (score % 5 === 0) {
      spawnEnemySnake();
    }
  }
}

/* ============================================================
   ===================== UPDATE ENEMIES =======================
   ============================================================ */

function updateEnemySnakes() {

  enemySnakes.forEach((e, index) => {

    const dist = Math.hypot(snake.x - e.x, snake.y - e.y);

    // Fogem do player se perto
    if (dist < 80) {
      e.angle = Math.atan2(e.y - snake.y, e.x - snake.x);
    } else {
      e.angle += (Math.random() - 0.5) * 0.1;
    }

    e.x += Math.cos(e.angle) * e.speed;
    e.y += Math.sin(e.angle) * e.speed;

    e.body.unshift({ x: e.x, y: e.y });
    if (e.body.length > e.length) e.body.pop();

    // Player come cobrinhas
    if (dist < 14) {
      score += e.size;
      updateUI();
      enemySnakes.splice(index, 1);
    }
  });
}

/* ============================================================
   ===================== UPDATE PLAYER SHOTS ==================
   ============================================================ */

function updatePlayerShots() {

  playerShots.forEach((s, i) => {
    s.x += Math.cos(s.angle) * s.speed;
    s.y += Math.sin(s.angle) * s.speed;

    if (
      s.x < 0 || s.x > BASE_WIDTH ||
      s.y < 0 || s.y > BASE_HEIGHT
    ) {
      playerShots.splice(i, 1);
    }
  });
}

/* ============================================================
   ===================== DRAW FOOD ============================
   ============================================================ */

function drawFood() {
  if (!food) return;

  ctx.fillStyle = "#ffeb3b";
  ctx.beginPath();
  ctx.arc(food.x, food.y, food.radius, 0, Math.PI * 2);
  ctx.fill();
}

/* ============================================================
   ===================== DRAW ENEMIES =========================
   ============================================================ */

function drawEnemySnakes() {
  ctx.fillStyle = "#2e7d32";

  enemySnakes.forEach(e => {
    e.body.forEach((p, i) => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 6 - i * 0.05, 0, Math.PI * 2);
      ctx.fill();
    });
  });
}

/* ============================================================
   ===================== DRAW PLAYER SHOTS ====================
   ============================================================ */

function drawPlayerShots() {
  ctx.fillStyle = "#00e5ff";
  playerShots.forEach(s => {
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
    ctx.fill();
  });
}

/* ============================================================
   ===================== LOOP INTEGRATION =====================
   ============================================================ */

const prevUpdate = update;
const prevDraw   = draw;

update = function(dt) {

  if (currentState === GAME_STATE.PLAYING) {
    updateFood();
    updateEnemySnakes();
    updatePlayerShots();
  }

  prevUpdate(dt);
};

draw = function() {

  prevDraw();

  if (currentState === GAME_STATE.PLAYING) {
    drawFood();
    drawEnemySnakes();
    drawPlayerShots();
  }
};

/* ============================================================
   ===================== INITIAL SPAWN ========================
   ============================================================ */

spawnFood();
</script>
<script>
/* ============================================================
   ===================== FASES / CEN√ÅRIOS =====================
   ============================================================ */

const PHASE_BACKGROUNDS = [
  ["#102e1c", "#0b1d13"],
  ["#1e3d2b", "#08150f"],
  ["#263238", "#000000"],
  ["#3e2723", "#1b0000"],
  ["#1a237e", "#000051"],
  ["#004d40", "#00251a"],
  ["#311b92", "#12005e"]
];

function drawDynamicBackground() {
  const phaseIndex = (phase - 1) % PHASE_BACKGROUNDS.length;
  const colors = PHASE_BACKGROUNDS[phaseIndex];

  const grad = ctx.createLinearGradient(0, 0, 0, BASE_HEIGHT);
  grad.addColorStop(0, colors[0]);
  grad.addColorStop(1, colors[1]);

  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, BASE_WIDTH, BASE_HEIGHT);

  ctx.fillStyle = "rgba(255,255,255,0.04)";
  for (let i = 0; i < 25; i++) {
    ctx.beginPath();
    ctx.arc(
      (i * 50 + bgOffset) % BASE_WIDTH,
      (i * 35 + bgOffset * 0.5) % BASE_HEIGHT,
      22,
      0,
      Math.PI * 2
    );
    ctx.fill();
  }
}

/* ============================================================
   ===================== BOSS SYSTEM ==========================
   ============================================================ */

let boss = null;
let bossShots = [];
let bossShootTimer = 0;

function spawnBoss() {
  boss = {
    x: BASE_WIDTH / 2,
    y: 80,
    angle: Math.PI / 2,
    speed: 0.6 + phase * 0.05,
    life: 3 + phase,
    maxLife: 3 + phase,
    length: 40 + phase * 6,
    body: []
  };
}

function updateBoss() {
  if (!boss) return;

  const dist = Math.hypot(snake.x - boss.x, snake.y - boss.y);

  // S√≥ se aproxima se o player chegar perto
  if (dist < 220) {
    boss.angle = Math.atan2(snake.y - boss.y, snake.x - boss.x);
    boss.x += Math.cos(boss.angle) * boss.speed;
    boss.y += Math.sin(boss.angle) * boss.speed;
  }

  boss.body.unshift({ x: boss.x, y: boss.y });
  if (boss.body.length > boss.length) boss.body.pop();

  // Colis√£o direta = morte
  if (dist < 18) {
    gameOver();
  }

  // Tiros estilo Mario
  bossShootTimer++;
  const shootDelay = Math.max(90 - phase * 3, 25);

  if (bossShootTimer > shootDelay) {
    bossShootTimer = 0;
    bossShots.push({
      x: boss.x,
      y: boss.y,
      angle: boss.angle,
      speed: 2 + phase * 0.08,
      radius: 5
    });
  }
}

/* ============================================================
   ===================== UPDATE BOSS SHOTS ====================
   ============================================================ */

function updateBossShots() {
  bossShots.forEach((b, i) => {
    b.x += Math.cos(b.angle) * b.speed;
    b.y += Math.sin(b.angle) * b.speed;

    if (Math.hypot(snake.x - b.x, snake.y - b.y) < 10) {
      gameOver();
    }

    if (
      b.x < 0 || b.x > BASE_WIDTH ||
      b.y < 0 || b.y > BASE_HEIGHT
    ) {
      bossShots.splice(i, 1);
    }
  });
}

/* ============================================================
   ===================== PLAYER vs BOSS =======================
   ============================================================ */

function checkBossHits() {
  playerShots.forEach((s, i) => {
    if (!boss) return;

    if (Math.hypot(s.x - boss.x, s.y - boss.y) < 22) {
      boss.life--;
      playerShots.splice(i, 1);

      if (boss.life <= 0) {
        score += 10;
        phase++;
        updateUI();

        boss = null;
        bossShots = [];

        if (phase > MAX_PHASE) {
          alert("üèÜ VOC√ä ZEROU O JOGO!");
          gameOver();
          return;
        }

        spawnBoss();
      }
    }
  });
}

/* ============================================================
   ===================== DRAW BOSS ============================
   ============================================================ */

function drawBoss() {
  if (!boss) return;

  ctx.fillStyle = "#b71c1c";
  boss.body.forEach((p, i) => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, 7 - i * 0.02, 0, Math.PI * 2);
    ctx.fill();
  });

  // Barra de vida
  ctx.fillStyle = "#ffffff";
  ctx.fillRect(boss.x - 22, boss.y - 34, 44, 6);

  ctx.fillStyle = "#e53935";
  ctx.fillRect(
    boss.x - 22,
    boss.y - 34,
    44 * (boss.life / boss.maxLife),
    6
  );
}

/* ============================================================
   ===================== DRAW BOSS SHOTS ======================
   ============================================================ */

function drawBossShots() {
  ctx.fillStyle = "#ff5252";
  bossShots.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
    ctx.fill();
  });
}

/* ============================================================
   ===================== LOOP INTEGRATION =====================
   ============================================================ */

const oldUpdate2 = update;
const oldDraw2 = draw;

update = function(dt) {
  if (currentState === GAME_STATE.PLAYING) {
    updateBoss();
    updateBossShots();
    checkBossHits();
  }
  oldUpdate2(dt);
};

draw = function() {
  drawDynamicBackground();
  oldDraw2();
  drawBoss();
  drawBossShots();
};

/* ============================================================
   ===================== INIT BOSS ============================
   ============================================================ */

spawnBoss();
</script>
<script>
/* ============================================================
   ===================== SISTEMA DE SOM =======================
   ============================================================ */

const SOUND_ENABLED = true;

const sounds = {
  shoot: new Audio("sounds/shoot.mp3"),
  hit: new Audio("sounds/hit.mp3"),
  bossHit: new Audio("sounds/boss_hit.mp3"),
  bossDie: new Audio("sounds/boss_die.mp3"),
  food: new Audio("sounds/food.mp3"),
  gameOver: new Audio("sounds/gameover.mp3"),
  victory: new Audio("sounds/victory.mp3")
};

Object.values(sounds).forEach(s => {
  s.volume = 0.6;
});

/* ============================================================
   ===================== PART√çCULAS ===========================
   ============================================================ */

let particles = [];

function spawnParticles(x, y, color, amount = 12) {
  for (let i = 0; i < amount; i++) {
    particles.push({
      x,
      y,
      vx: (Math.random() - 0.5) * 3,
      vy: (Math.random() - 0.5) * 3,
      life: 30,
      color
    });
  }
}

function updateParticles() {
  particles.forEach((p, i) => {
    p.x += p.vx;
    p.y += p.vy;
    p.life--;
    if (p.life <= 0) particles.splice(i, 1);
  });
}

function drawParticles() {
  particles.forEach(p => {
    ctx.fillStyle = p.color;
    ctx.globalAlpha = p.life / 30;
    ctx.beginPath();
    ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
    ctx.fill();
    ctx.globalAlpha = 1;
  });
}

/* ============================================================
   ===================== GAME OVER & VIT√ìRIA =================
   ============================================================ */

let victory = false;

function gameOver() {
  running = false;
  victory = false;
  if (SOUND_ENABLED) sounds.gameOver.play();
  document.getElementById("menu").style.display = "flex";
}

function victoryScreen() {
  running = false;
  victory = true;
  if (SOUND_ENABLED) sounds.victory.play();
  document.getElementById("menu").style.display = "flex";
  document.querySelector("#menu h2").textContent = "üèÜ VIT√ìRIA TOTAL!";
}

/* ============================================================
   ===================== EXTENS√ïES DE EVENTOS =================
   ============================================================ */

// Override ataque do player com som + part√≠culas
const oldShootPlayer = shootPlayer;
shootPlayer = function() {
  oldShootPlayer();
  if (SOUND_ENABLED) sounds.shoot.play();
  spawnParticles(snake.x, snake.y, "#00e5ff", 6);
};

// Override coleta de comida
const oldSpawnFood = spawnFood;
spawnFood = function() {
  oldSpawnFood();
  if (SOUND_ENABLED) sounds.food.play();
};

// Override hit no boss
const oldCheckBossHits = checkBossHits;
checkBossHits = function() {
  playerShots.forEach((s, i) => {
    if (!boss) return;
    if (Math.hypot(s.x - boss.x, s.y - boss.y) < 22) {
      spawnParticles(boss.x, boss.y, "#ff5252", 20);
      if (SOUND_ENABLED) sounds.bossHit.play();
    }
  });
  oldCheckBossHits();
};

// Override morte do boss
const oldSpawnBoss = spawnBoss;
spawnBoss = function() {
  if (boss && SOUND_ENABLED) sounds.bossDie.play();
  oldSpawnBoss();
};

/* ============================================================
   ===================== UPDATE FINAL =========================
   ============================================================ */

const oldUpdateFinal = update;
update = function(dt) {
  oldUpdateFinal(dt);
  updateParticles();
};

/* ============================================================
   ===================== DRAW FINAL ===========================
   ============================================================ */

const oldDrawFinal = draw;
draw = function() {
  oldDrawFinal();
  drawParticles();
};

/* ============================================================
   ===================== FINAL CHECK ==========================
   ============================================================ */

// Vit√≥ria total ao zerar fases
const oldSpawnBossFinal = spawnBoss;
spawnBoss = function() {
  if (phase > MAX_PHASE) {
    victoryScreen();
    return;
  }
  oldSpawnBossFinal();
};

</script>
