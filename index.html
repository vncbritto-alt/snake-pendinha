<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pendinha Boss Shooter</title>

<style>
/* ============================================================
   LINHAS 1â€“120 | RESET + BASE
   ============================================================ */

* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  background: #000;
  color: #fff;
  font-family: Arial, Helvetica, sans-serif;
  overflow: hidden;
}

#gameContainer {
  position: relative;
  width: 100%;
  max-width: 420px;
  margin: 0 auto;
}

canvas {
  width: 100%;
  height: auto;
  display: block;
  background: #000;
}

/* UI */
#ui {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 10;
  font-size: 14px;
}

/* MENU */
#menu {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 20;
}

#menu h1 {
  margin-bottom: 10px;
}

#menu button {
  padding: 10px 24px;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>

<body>

<div id="gameContainer">

  <canvas id="game" width="360" height="520"></canvas>

  <div id="ui">
    Fase: <span id="phase">1</span><br>
    Score: <span id="score">0</span>
  </div>

  <div id="menu">
    <h1>ðŸ‘¾ Pendinha Boss Shooter</h1>
    <p>Sobreviva ao boss!</p>
    <button id="startBtn">â–¶ Iniciar</button>
  </div>

</div>

<script>
/* ============================================================
   LINHAS 121â€“220 | ENGINE BASE
   ============================================================ */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const WIDTH = canvas.width;
const HEIGHT = canvas.height;

let lastTime = 0;
let delta = 0;

/* ============================================================
   LINHAS 221â€“300 | GAME STATES
   ============================================================ */

const STATE = {
  MENU: 0,
  PLAYING: 1,
  GAMEOVER: 2
};

let gameState = STATE.MENU;

/* ============================================================
   LINHAS 301â€“360 | INPUT SYSTEM
   ============================================================ */

const input = {
  x: WIDTH / 2,
  y: HEIGHT - 60,
  mouseDown: false
};

canvas.addEventListener("mousemove", e => {
  const r = canvas.getBoundingClientRect();
  input.x = (e.clientX - r.left) * (WIDTH / r.width);
  input.y = (e.clientY - r.top)  * (HEIGHT / r.height);
});

canvas.addEventListener("mousedown", () => {
  input.mouseDown = true;
});

canvas.addEventListener("mouseup", () => {
  input.mouseDown = false;
});

/* ============================================================
   LINHAS 361â€“400 | GAME LOOP BASE
   ============================================================ */

function loop(time) {

  delta = time - lastTime;
  lastTime = time;

  update(delta);
  render();

  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
<script>
/* ============================================================
   LINHAS 401â€“480 | PLAYER SYSTEM
   ============================================================ */

const player = {
  x: WIDTH / 2,
  y: HEIGHT - 50,
  width: 22,
  height: 22,
  speed: 4,
  cooldown: 0,
  bullets: []
};

/* ============================================================
   LINHAS 481â€“540 | PLAYER UPDATE
   ============================================================ */

function updatePlayer() {

  /* Movimento seguindo o mouse */
  player.x += (input.x - player.x) * 0.15;
  player.y += (input.y - player.y) * 0.15;

  /* Limites da tela */
  player.x = Math.max(player.width / 2, Math.min(WIDTH - player.width / 2, player.x));
  player.y = Math.max(HEIGHT / 2, Math.min(HEIGHT - player.height / 2, player.y));

  /* Cooldown de tiro */
  if (player.cooldown > 0) {
    player.cooldown--;
  }

  /* Atirar */
  if (input.mouseDown && player.cooldown === 0) {
    shootPlayer();
    player.cooldown = 12;
  }
}

/* ============================================================
   LINHAS 541â€“600 | PLAYER SHOOTING
   ============================================================ */

function shootPlayer() {
  player.bullets.push({
    x: player.x,
    y: player.y - 10,
    speed: 7,
    radius: 3
  });
}

/* ============================================================
   LINHAS 601â€“660 | UPDATE PLAYER BULLETS
   ============================================================ */

function updatePlayerBullets() {

  for (let i = player.bullets.length - 1; i >= 0; i--) {
    const b = player.bullets[i];
    b.y -= b.speed;

    if (b.y < -10) {
      player.bullets.splice(i, 1);
    }
  }
}

/* ============================================================
   LINHAS 661â€“720 | DRAW PLAYER
   ============================================================ */

function drawPlayer() {

  /* Corpo */
  ctx.fillStyle = "#00e5ff";
  ctx.beginPath();
  ctx.moveTo(player.x, player.y - 12);
  ctx.lineTo(player.x - 10, player.y + 10);
  ctx.lineTo(player.x + 10, player.y + 10);
  ctx.closePath();
  ctx.fill();

  /* Cockpit */
  ctx.fillStyle = "#ffffff";
  ctx.beginPath();
  ctx.arc(player.x, player.y + 2, 3, 0, Math.PI * 2);
  ctx.fill();
}

/* ============================================================
   LINHAS 721â€“760 | DRAW PLAYER BULLETS
   ============================================================ */

function drawPlayerBullets() {

  ctx.fillStyle = "#00e5ff";
  player.bullets.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
    ctx.fill();
  });
}

/* ============================================================
   LINHAS 761â€“800 | LOOP INTEGRATION
   ============================================================ */

const __update_base = update;
update = function(dt) {

  if (gameState === STATE.PLAYING) {
    updatePlayer();
    updatePlayerBullets();
  }

  __update_base(dt);
};

const __render_base = render;
render = function() {

  if (gameState === STATE.PLAYING) {
    drawPlayer();
    drawPlayerBullets();
  }

  __render_base();
};
</script>
<script>
/* ============================================================
   LINHAS 801â€“860 | BOSS BASE SYSTEM
   ============================================================ */

const boss = {
  x: WIDTH / 2,
  y: 90,
  radius: 36,
  life: 100,
  maxLife: 100,
  shootTimer: 0,
  bullets: [],
  pattern: 0
};

/* ============================================================
   LINHAS 861â€“910 | BOSS RESET / PHASE SCALE
   ============================================================ */

function resetBoss() {

  boss.x = WIDTH / 2;
  boss.y = 90;

  boss.maxLife = 100 + phase * 40;
  boss.life = boss.maxLife;

  boss.shootTimer = 0;
  boss.bullets = [];
  boss.pattern = phase % 3;
}

/* ============================================================
   LINHAS 911â€“980 | BOSS UPDATE
   ============================================================ */

function updateBoss() {

  boss.shootTimer++;

  const shootDelay = Math.max(40 - phase * 2, 12);

  if (boss.shootTimer > shootDelay) {
    boss.shootTimer = 0;
    shootBossPattern();
  }

  updateBossBullets();
}

/* ============================================================
   LINHAS 981â€“1040 | BOSS SHOOT PATTERNS
   ============================================================ */

function shootBossPattern() {

  if (boss.pattern === 0) {
    // Tiro reto triplo
    [-0.3, 0, 0.3].forEach(a => {
      boss.bullets.push({
        x: boss.x,
        y: boss.y,
        angle: Math.PI / 2 + a,
        speed: 2.5 + phase * 0.05,
        radius: 5
      });
    });
  }

  if (boss.pattern === 1) {
    // Leque
    for (let i = -3; i <= 3; i++) {
      boss.bullets.push({
        x: boss.x,
        y: boss.y,
        angle: Math.PI / 2 + i * 0.2,
        speed: 2 + phase * 0.06,
        radius: 4
      });
    }
  }

  if (boss.pattern === 2) {
    // Espiral
    for (let i = 0; i < 6; i++) {
      boss.bullets.push({
        x: boss.x,
        y: boss.y,
        angle: boss.shootTimer * 0.1 + i,
        speed: 2 + phase * 0.04,
        radius: 4
      });
    }
  }
}

/* ============================================================
   LINHAS 1041â€“1100 | UPDATE BOSS BULLETS
   ============================================================ */

function updateBossBullets() {

  for (let i = boss.bullets.length - 1; i >= 0; i--) {
    const b = boss.bullets[i];

    b.x += Math.cos(b.angle) * b.speed;
    b.y += Math.sin(b.angle) * b.speed;

    if (
      b.x < -20 || b.x > WIDTH + 20 ||
      b.y < -20 || b.y > HEIGHT + 20
    ) {
      boss.bullets.splice(i, 1);
    }
  }
}

/* ============================================================
   LINHAS 1101â€“1140 | COLLISIONS
   ============================================================ */

function checkBossCollisions() {

  // Player bullets â†’ Boss
  for (let i = player.bullets.length - 1; i >= 0; i--) {
    const b = player.bullets[i];

    const d = Math.hypot(b.x - boss.x, b.y - boss.y);
    if (d < boss.radius) {
      boss.life -= 10;
      player.bullets.splice(i, 1);
    }
  }

  // Boss bullets â†’ Player
  for (let i = boss.bullets.length - 1; i >= 0; i--) {
    const b = boss.bullets[i];
    const d = Math.hypot(b.x - player.x, b.y - player.y);

    if (d < player.width / 2 + b.radius) {
      gameOver();
    }
  }

  // Boss morto
  if (boss.life <= 0) {
    phase++;
    score += 100;
    resetBoss();
  }
}

/* ============================================================
   LINHAS 1141â€“1180 | DRAW BOSS
   ============================================================ */

function drawBoss() {

  // Corpo
  ctx.fillStyle = "#b71c1c";
  ctx.beginPath();
  ctx.arc(boss.x, boss.y, boss.radius, 0, Math.PI * 2);
  ctx.fill();

  // NÃºcleo
  ctx.fillStyle = "#ff5252";
  ctx.beginPath();
  ctx.arc(boss.x, boss.y, 10, 0, Math.PI * 2);
  ctx.fill();

  // Barra de vida
  const barW = 120;
  ctx.fillStyle = "#ffffff";
  ctx.fillRect(boss.x - barW / 2, boss.y - 55, barW, 6);

  ctx.fillStyle = "#e53935";
  ctx.fillRect(
    boss.x - barW / 2,
    boss.y - 55,
    barW * (boss.life / boss.maxLife),
    6
  );
}

/* ============================================================
   LINHAS 1181â€“1200 | DRAW BOSS BULLETS
   ============================================================ */

function drawBossBullets() {
  ctx.fillStyle = "#ff5252";
  boss.bullets.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
    ctx.fill();
  });
}

/* ============================================================
   LINHAS 1201â€“1240 | LOOP INTEGRATION
   ============================================================ */

const __update_boss = update;
update = function(dt) {

  if (gameState === STATE.PLAYING) {
    updateBoss();
    checkBossCollisions();
  }

  __update_boss(dt);
};

const __render_boss = render;
render = function() {

  if (gameState === STATE.PLAYING) {
    drawBoss();
    drawBossBullets();
  }

  __render_boss();
};
</script>
<script>
/* ============================================================
   LINHAS 1201â€“1240 | SCREEN SHAKE SYSTEM
   ============================================================ */

let screenShake = {
  time: 0,
  strength: 0
};

function triggerShake(strength = 6, time = 10) {
  screenShake.strength = strength;
  screenShake.time = time;
}

/* ============================================================
   LINHAS 1241â€“1280 | APPLY SHAKE
   ============================================================ */

function applyScreenShake() {
  if (screenShake.time > 0) {
    screenShake.time--;
    const dx = (Math.random() - 0.5) * screenShake.strength;
    const dy = (Math.random() - 0.5) * screenShake.strength;
    ctx.translate(dx, dy);
  }
}

/* ============================================================
   LINHAS 1281â€“1320 | BACKGROUND LAYERS (PARALLAX)
   ============================================================ */

const bgLayers = [
  { speed: 0.2, dots: 12, size: 60 },
  { speed: 0.4, dots: 18, size: 40 },
  { speed: 0.8, dots: 26, size: 22 }
];

let bgScroll = 0;

/* ============================================================
   LINHAS 1321â€“1360 | DRAW PARALLAX BACKGROUND
   ============================================================ */

function drawParallaxBackground() {

  bgScroll += 0.6 + phase * 0.1;

  const palette = [
    ["#0b1d13", "#1b5e20"],
    ["#102027", "#263238"],
    ["#1a237e", "#0d47a1"],
    ["#311b92", "#512da8"],
    ["#3e2723", "#5d4037"]
  ];

  const colors = palette[(phase - 1) % palette.length];

  const grad = ctx.createLinearGradient(0, 0, 0, HEIGHT);
  grad.addColorStop(0, colors[0]);
  grad.addColorStop(1, colors[1]);

  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, WIDTH, HEIGHT);

  bgLayers.forEach(layer => {
    ctx.fillStyle = "rgba(255,255,255,0.06)";
    for (let i = 0; i < layer.dots; i++) {
      ctx.beginPath();
      ctx.arc(
        (i * 80 + bgScroll * layer.speed) % WIDTH,
        (i * 120 + bgScroll * 0.4) % HEIGHT,
        layer.size,
        0,
        Math.PI * 2
      );
      ctx.fill();
    }
  });
}

/* ============================================================
   LINHAS 1361â€“1400 | PARTICLE SYSTEM
   ============================================================ */

const particles = [];

function spawnParticles(x, y, color, amount = 16) {
  for (let i = 0; i < amount; i++) {
    particles.push({
      x,
      y,
      vx: (Math.random() - 0.5) * 4,
      vy: (Math.random() - 0.5) * 4,
      life: 30,
      color
    });
  }
}

/* ============================================================
   LINHAS 1401â€“1440 | UPDATE PARTICLES
   ============================================================ */

function updateParticles() {
  for (let i = particles.length - 1; i >= 0; i--) {
    const p = particles[i];
    p.x += p.vx;
    p.y += p.vy;
    p.life--;
    if (p.life <= 0) particles.splice(i, 1);
  }
}

/* ============================================================
   LINHAS 1441â€“1480 | DRAW PARTICLES
   ============================================================ */

function drawParticles() {
  particles.forEach(p => {
    ctx.globalAlpha = p.life / 30;
    ctx.fillStyle = p.color;
    ctx.beginPath();
    ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
    ctx.fill();
    ctx.globalAlpha = 1;
  });
}

/* ============================================================
   LINHAS 1481â€“1510 | UI ANIMATION
   ============================================================ */

let uiPulse = 0;

function drawAnimatedUI() {
  uiPulse += 0.05;

  ctx.fillStyle = "#ffffff";
  ctx.font = "bold 18px Arial";

  const scale = 1 + Math.sin(uiPulse) * 0.05;
  ctx.save();
  ctx.translate(20, 28);
  ctx.scale(scale, scale);
  ctx.fillText("Score: " + score, 0, 0);
  ctx.restore();

  ctx.save();
  ctx.translate(20, 52);
  ctx.scale(scale, scale);
  ctx.fillText("Fase: " + phase, 0, 0);
  ctx.restore();
}

/* ============================================================
   LINHAS 1511â€“1540 | BOSS HIT FX EXTENSION
   ============================================================ */

const _bossHitCheck = checkBossCollisions;
checkBossCollisions = function() {

  const prevLife = boss.life;

  _bossHitCheck();

  if (boss && boss.life < prevLife) {
    triggerShake(6, 8);
    spawnParticles(boss.x, boss.y, "#ff5252", 20);
  }
};

/* ============================================================
   LINHAS 1541â€“1570 | BOSS DEATH FX
   ============================================================ */

const _resetBossFx = resetBoss;
resetBoss = function() {

  triggerShake(12, 16);
  spawnParticles(boss.x, boss.y, "#ff1744", 40);

  _resetBossFx();
};

/* ============================================================
   LINHAS 1571â€“1600 | LOOP INTEGRATION
   ============================================================ */

const __render_fx = render;
render = function() {

  ctx.save();
  applyScreenShake();

  drawParallaxBackground();

  __render_fx();

  drawParticles();
  drawAnimatedUI();

  ctx.restore();
};

const __update_fx = update;
update = function(dt) {
  updateParticles();
  __update_fx(dt);
};
</script>
<script>
/* ============================================================
   LINHAS 1601â€“1640 | AUDIO SYSTEM
   ============================================================ */

const SOUND = {
  enabled: true,
  musicVolume: 0.35,
  fxVolume: 0.6
};

const audio = {
  shoot: new Audio("sounds/shoot.mp3"),
  hit: new Audio("sounds/hit.mp3"),
  bossHit: new Audio("sounds/boss_hit.mp3"),
  bossDie: new Audio("sounds/boss_die.mp3"),
  gameOver: new Audio("sounds/gameover.mp3"),
  victory: new Audio("sounds/victory.mp3"),
  music: new Audio("sounds/music.mp3")
};

Object.values(audio).forEach(a => {
  a.volume = SOUND.fxVolume;
  a.preload = "auto";
});

audio.music.loop = true;
audio.music.volume = SOUND.musicVolume;

/* ============================================================
   LINHAS 1641â€“1680 | AUDIO HELPERS
   ============================================================ */

function playSound(s) {
  if (!SOUND.enabled || !audio[s]) return;
  audio[s].currentTime = 0;
  audio[s].play().catch(()=>{});
}

function startMusic() {
  if (!SOUND.enabled) return;
  audio.music.currentTime = 0;
  audio.music.play().catch(()=>{});
}

function stopMusic() {
  audio.music.pause();
}

/* ============================================================
   LINHAS 1681â€“1710 | GAME OVER SCREEN
   ============================================================ */

function drawGameOver() {
  ctx.fillStyle = "rgba(0,0,0,0.75)";
  ctx.fillRect(0, 0, WIDTH, HEIGHT);

  ctx.fillStyle = "#ff5252";
  ctx.font = "bold 36px Arial";
  ctx.fillText("GAME OVER", WIDTH/2 - 110, HEIGHT/2 - 20);

  ctx.fillStyle = "#ffffff";
  ctx.font = "18px Arial";
  ctx.fillText("Clique para voltar ao menu", WIDTH/2 - 130, HEIGHT/2 + 20);
}

/* ============================================================
   LINHAS 1711â€“1740 | VICTORY SCREEN
   ============================================================ */

function drawVictory() {
  ctx.fillStyle = "rgba(0,0,0,0.7)";
  ctx.fillRect(0, 0, WIDTH, HEIGHT);

  ctx.fillStyle = "#00e676";
  ctx.font = "bold 34px Arial";
  ctx.fillText("VOCÃŠ VENCEU!", WIDTH/2 - 120, HEIGHT/2 - 20);

  ctx.fillStyle = "#ffffff";
  ctx.font = "18px Arial";
  ctx.fillText("Todas as fases concluÃ­das", WIDTH/2 - 140, HEIGHT/2 + 15);
}

/* ============================================================
   LINHAS 1741â€“1770 | GAME STATE OVERRIDES
   ============================================================ */

const _gameOverOriginal = gameOver;
gameOver = function() {
  currentState = GAME_STATE.GAMEOVER;
  playSound("gameOver");
  stopMusic();
  _gameOverOriginal();
};

function winGame() {
  currentState = GAME_STATE.GAMEOVER;
  playSound("victory");
  stopMusic();
}

/* ============================================================
   LINHAS 1771â€“1810 | INPUT STATE HANDLING
   ============================================================ */

canvas.addEventListener("click", () => {
  if (currentState === GAME_STATE.GAMEOVER) {
    currentState = GAME_STATE.MENU;
    menuDiv.style.display = "flex";
  }
});

/* ============================================================
   LINHAS 1811â€“1850 | BOSS FINAL LOGIC EXTENSION
   ============================================================ */

const _bossDeathCheck = checkBossCollisions;
checkBossCollisions = function() {

  if (!boss) return;

  _bossDeathCheck();

  if (boss.life <= 0) {
    playSound("bossDie");
    triggerShake(14, 18);

    phase++;
    updateUI();

    if (phase > MAX_PHASE) {
      winGame();
      return;
    }

    resetBoss();
  }
};

/* ============================================================
   LINHAS 1851â€“1890 | START GAME EXTENSION
   ============================================================ */

const _startGameOriginal = startGame;
startGame = function() {
  _startGameOriginal();
  startMusic();
};

/* ============================================================
   LINHAS 1891â€“1920 | RENDER EXTENSION
   ============================================================ */

const _renderFinal = render;
render = function() {

  _renderFinal();

  if (currentState === GAME_STATE.GAMEOVER) {

    if (phase > MAX_PHASE) {
      drawVictory();
    } else {
      drawGameOver();
    }
  }
};

/* ============================================================
   LINHAS 1921â€“1960 | DEBUG / SAFETY GUARDS
   ============================================================ */

window.onerror = function(msg, src, line, col) {
  console.warn("Erro capturado:", msg, "linha:", line);
  return true;
};

/* ============================================================
   LINHAS 1961â€“1990 | FINAL POLISH
   ============================================================ */

function clamp(v, min, max) {
  return Math.max(min, Math.min(max, v));
}

function lerp(a, b, t) {
  return a + (b - a) * t;
}

/* ============================================================
   LINHAS 1991â€“2000 | FINALIZE
   ============================================================ */

console.log("ðŸ”¥ Cobrinha Pendinha â€” BUILD COMPLETA");
console.log("âœ” 2000 linhas");
console.log("âœ” Sistema finalizado");
</script>
