<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pendinha Boss Shooter</title>

<style>
/* ============================================================
   RESET + BASE
   ============================================================ */
* { box-sizing: border-box; }

html, body {
  margin: 0;
  padding: 0;
  background: #000;
  font-family: Arial, Helvetica, sans-serif;
  overflow: hidden;
  color: #fff;
}

/* ============================================================
   CONTAINER
   ============================================================ */
#gameContainer {
  position: relative;
  width: 100%;
  max-width: 420px;
  margin: 0 auto;
}

/* ============================================================
   CANVAS
   ============================================================ */
canvas {
  width: 100%;
  height: auto;
  display: block;
  background: #000;
}

/* ============================================================
   UI
   ============================================================ */
#ui {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 10;
  font-size: 14px;
  pointer-events: none;
}

/* ============================================================
   MENU
   ============================================================ */
#menu {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 20;
}

#menu h1 {
  margin: 0 0 10px 0;
}

#menu p {
  margin: 4px 0 12px 0;
}

#menu button {
  padding: 10px 26px;
  font-size: 16px;
  cursor: pointer;
  border: none;
  border-radius: 6px;
  background: #00e5ff;
  color: #000;
}
</style>
</head>

<body>

<div id="gameContainer">

  <canvas id="game" width="360" height="520"></canvas>

  <div id="ui">
    Fase: <span id="phase">1</span><br>
    Score: <span id="score">0</span>
  </div>

  <div id="menu">
    <h1>ðŸ‘¾ Pendinha Boss Shooter</h1>
    <p>Sobreviva Ã s fases</p>
    <button id="startBtn">â–¶ Iniciar</button>
  </div>

</div>

<script>
/* ============================================================
   ENGINE BASE
   ============================================================ */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const WIDTH = canvas.width;
const HEIGHT = canvas.height;

let lastTime = 0;

/* ============================================================
   GAME STATES
   ============================================================ */
const STATE = {
  MENU: 0,
  PLAYING: 1,
  GAMEOVER: 2
};

let gameState = STATE.MENU;

/* ============================================================
   GAME DATA
   ============================================================ */
let score = 0;
let phase = 1;
const MAX_PHASE = 20;

/* ============================================================
   INPUT SYSTEM
   ============================================================ */
const input = {
  x: WIDTH / 2,
  y: HEIGHT - 80,
  mouseDown: false
};

canvas.addEventListener("mousemove", e => {
  const r = canvas.getBoundingClientRect();
  input.x = (e.clientX - r.left) * (WIDTH / r.width);
  input.y = (e.clientY - r.top)  * (HEIGHT / r.height);
});

canvas.addEventListener("mousedown", () => {
  input.mouseDown = true;
});

canvas.addEventListener("mouseup", () => {
  input.mouseDown = false;
});

/* ============================================================
   UI UPDATE
   ============================================================ */
function updateUI() {
  document.getElementById("score").textContent = score;
  document.getElementById("phase").textContent = phase;
}

/* ============================================================
   PLAYER SYSTEM
   ============================================================ */
const player = {
  x: WIDTH / 2,
  y: HEIGHT - 60,
  size: 18,
  speed: 0.15,
  cooldown: 0,
  bullets: []
};

/* ============================================================
   PLAYER UPDATE
   ============================================================ */
function updatePlayer() {
  player.x += (input.x - player.x) * player.speed;
  player.y += (input.y - player.y) * player.speed;

  player.x = Math.max(player.size, Math.min(WIDTH - player.size, player.x));
  player.y = Math.max(player.size, Math.min(HEIGHT - player.size, player.y));

  if (player.cooldown > 0) player.cooldown--;

  if (input.mouseDown && player.cooldown === 0) {
    shootPlayer();
    player.cooldown = 12;
  }
}

/* ============================================================
   PLAYER SHOOT
   ============================================================ */
function shootPlayer() {
  player.bullets.push({
    x: player.x,
    y: player.y - 10,
    speed: 7,
    radius: 3
  });
}

/* ============================================================
   UPDATE PLAYER BULLETS
   ============================================================ */
function updatePlayerBullets() {
  for (let i = player.bullets.length - 1; i >= 0; i--) {
    const b = player.bullets[i];
    b.y -= b.speed;
    if (b.y < -20) player.bullets.splice(i, 1);
  }
}

/* ============================================================
   DRAW PLAYER
   ============================================================ */
function drawPlayer() {
  ctx.fillStyle = "#00e5ff";
  ctx.beginPath();
  ctx.moveTo(player.x, player.y - 14);
  ctx.lineTo(player.x - 12, player.y + 12);
  ctx.lineTo(player.x + 12, player.y + 12);
  ctx.closePath();
  ctx.fill();
}

/* ============================================================
   DRAW PLAYER BULLETS
   ============================================================ */
function drawPlayerBullets() {
  ctx.fillStyle = "#00e5ff";
  player.bullets.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
    ctx.fill();
  });
}

/* ============================================================
   GAME START
   ============================================================ */
document.getElementById("startBtn").onclick = () => {
  score = 0;
  phase = 1;
  updateUI();
  player.bullets = [];
  gameState = STATE.PLAYING;
  document.getElementById("menu").style.display = "none";
};

/* ============================================================
   GAME LOOP
   ============================================================ */
function update(dt) {
  if (gameState === STATE.PLAYING) {
    updatePlayer();
    updatePlayerBullets();
  }
}

function render() {
  ctx.fillStyle = "#000";
  ctx.fillRect(0, 0, WIDTH, HEIGHT);

  if (gameState === STATE.PLAYING) {
    drawPlayer();
    drawPlayerBullets();
  }
}

function loop(time) {
  const dt = time - lastTime;
  lastTime = time;

  update(dt);
  render();

  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
</script>

</body>
</html>
<script>
/* ============================================================
   INIMIGOS â€“ NAVES PEQUENAS E MÃ‰DIAS
   ============================================================ */

const enemies = [];

/* Tipos de inimigos */
const ENEMY_TYPES = {
  SMALL: { size: 14, life: 1, speed: 1.8, score: 10 },
  MEDIUM:{ size: 20, life: 3, speed: 1.2, score: 30 }
};

/* ============================================================
   SPAWN DE INIMIGOS
   ============================================================ */

let enemySpawnTimer = 0;

function spawnEnemy() {
  const type = Math.random() < 0.7 ? ENEMY_TYPES.SMALL : ENEMY_TYPES.MEDIUM;

  enemies.push({
    x: Math.random() * (WIDTH - 40) + 20,
    y: -30,
    vx: (Math.random() - 0.5) * 1.2,
    vy: type.speed,
    size: type.size,
    life: type.life,
    score: type.score
  });
}

/* ============================================================
   UPDATE INIMIGOS
   ============================================================ */

function updateEnemies() {

  enemySpawnTimer++;
  const spawnRate = Math.max(40 - phase * 2, 15);

  if (enemySpawnTimer > spawnRate) {
    enemySpawnTimer = 0;
    spawnEnemy();
  }

  for (let i = enemies.length - 1; i >= 0; i--) {
    const e = enemies[i];

    e.x += e.vx;
    e.y += e.vy;

    /* Saiu da tela */
    if (e.y > HEIGHT + 40) {
      enemies.splice(i, 1);
      continue;
    }

    /* ColisÃ£o com player */
    const dp = Math.hypot(player.x - e.x, player.y - e.y);
    if (dp < player.size + e.size * 0.6) {
      gameOver();
      return;
    }

    /* ColisÃ£o com tiros */
    for (let j = player.bullets.length - 1; j >= 0; j--) {
      const b = player.bullets[j];
      const d = Math.hypot(b.x - e.x, b.y - e.y);

      if (d < e.size) {
        e.life--;
        player.bullets.splice(j, 1);

        if (e.life <= 0) {
          score += e.score;
          updateUI();
          enemies.splice(i, 1);
        }
        break;
      }
    }
  }
}

/* ============================================================
   DRAW INIMIGOS
   ============================================================ */

function drawEnemies() {

  enemies.forEach(e => {

    ctx.fillStyle = e.life === 1 ? "#ffeb3b" : "#ff9800";

    /* Desenho em forma de TRIÃ‚NGULO (nave) */
    ctx.beginPath();
    ctx.moveTo(e.x, e.y - e.size);
    ctx.lineTo(e.x - e.size, e.y + e.size);
    ctx.lineTo(e.x + e.size, e.y + e.size);
    ctx.closePath();
    ctx.fill();

    /* NÃºcleo */
    ctx.fillStyle = "#000";
    ctx.beginPath();
    ctx.arc(e.x, e.y + 2, 3, 0, Math.PI * 2);
    ctx.fill();
  });
}

/* ============================================================
   INTEGRAÃ‡ÃƒO COM LOOP EXISTENTE
   ============================================================ */

const __update_part2 = update;
update = function(dt) {

  if (gameState === STATE.PLAYING) {
    updateEnemies();
  }

  __update_part2(dt);
};

const __render_part2 = render;
render = function() {

  if (gameState === STATE.PLAYING) {
    drawEnemies();
  }

  __render_part2();
};

/* ============================================================
   GAME OVER
   ============================================================ */

function gameOver() {
  gameState = STATE.GAMEOVER;
  document.getElementById("menu").style.display = "flex";
  document.querySelector("#menu h1").textContent = "ðŸ’€ GAME OVER";
}
</script>
<script>
/* ============================================================
   SISTEMA DE ARMAS DO PLAYER
   ============================================================ */

const WEAPONS = {
  BASIC: "basic",
  DOUBLE: "double",
  SPREAD: "spread",
  RAPID: "rapid"
};

let currentWeapon = WEAPONS.BASIC;
let weaponTimer = 0;

/* ============================================================
   POWER UPS
   ============================================================ */

const powerUps = [];

function spawnPowerUp(x, y) {
  const types = Object.values(WEAPONS);
  powerUps.push({
    x,
    y,
    type: types[Math.floor(Math.random() * types.length)],
    radius: 10
  });
}

function updatePowerUps() {

  for (let i = powerUps.length - 1; i >= 0; i--) {
    const p = powerUps[i];
    p.y += 1;

    if (p.y > HEIGHT + 20) {
      powerUps.splice(i, 1);
      continue;
    }

    const d = Math.hypot(player.x - p.x, player.y - p.y);
    if (d < player.size + p.radius) {
      activatePowerUp(p.type);
      powerUps.splice(i, 1);
    }
  }
}

function activatePowerUp(type) {
  currentWeapon = type;
  weaponTimer = 600; // duraÃ§Ã£o do power-up
}

/* ============================================================
   TIROS DO PLAYER (VARIADOS)
   ============================================================ */

const __shootPlayer_original = shootPlayer;
shootPlayer = function() {

  if (currentWeapon === WEAPONS.BASIC) {
    __shootPlayer_original();
  }

  if (currentWeapon === WEAPONS.DOUBLE) {
    player.bullets.push(
      { x: player.x - 6, y: player.y, speed: 7, angle: -Math.PI / 2, radius: 3 },
      { x: player.x + 6, y: player.y, speed: 7, angle: -Math.PI / 2, radius: 3 }
    );
  }

  if (currentWeapon === WEAPONS.SPREAD) {
    [-0.3, 0, 0.3].forEach(a => {
      player.bullets.push({
        x: player.x,
        y: player.y,
        speed: 6,
        angle: -Math.PI / 2 + a,
        radius: 3
      });
    });
  }

  if (currentWeapon === WEAPONS.RAPID) {
    player.bullets.push({
      x: player.x,
      y: player.y,
      speed: 9,
      angle: -Math.PI / 2,
      radius: 2
    });
  }
};

/* ============================================================
   UPDATE ARMAS
   ============================================================ */

const __update_weapon = update;
update = function(dt) {

  if (weaponTimer > 0) {
    weaponTimer--;
    if (weaponTimer === 0) {
      currentWeapon = WEAPONS.BASIC;
    }
  }

  updatePowerUps();
  __update_weapon(dt);
};

/* ============================================================
   DRAW POWER UPS
   ============================================================ */

function drawPowerUps() {

  powerUps.forEach(p => {
    ctx.fillStyle = "#00e676";
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#000";
    ctx.font = "10px Arial";
    ctx.fillText(p.type[0].toUpperCase(), p.x - 3, p.y + 4);
  });
}

const __render_powerups = render;
render = function() {

  if (gameState === STATE.PLAYING) {
    drawPowerUps();
  }

  __render_powerups();
};

/* ============================================================
   INIMIGOS ATIRADORES
   ============================================================ */

const shooterEnemies = [];

function spawnShooterEnemy() {
  shooterEnemies.push({
    x: Math.random() * (WIDTH - 40) + 20,
    y: -30,
    life: 3,
    shootTimer: 0,
    bullets: []
  });
}

let shooterSpawnTimer = 0;

function updateShooterEnemies() {

  shooterSpawnTimer++;
  if (shooterSpawnTimer > Math.max(300 - phase * 10, 120)) {
    shooterSpawnTimer = 0;
    spawnShooterEnemy();
  }

  shooterEnemies.forEach((e, i) => {
    e.y += 1.1;

    e.shootTimer++;
    if (e.shootTimer > 60) {
      e.shootTimer = 0;
      e.bullets.push({
        x: e.x,
        y: e.y,
        angle: Math.PI / 2,
        speed: 3,
        radius: 4
      });
    }

    // tiros
    e.bullets.forEach((b, j) => {
      b.x += Math.cos(b.angle) * b.speed;
      b.y += Math.sin(b.angle) * b.speed;

      if (Math.hypot(player.x - b.x, player.y - b.y) < player.size + b.radius) {
        gameOver();
      }

      if (b.y > HEIGHT) e.bullets.splice(j, 1);
    });

    // colisÃ£o com player bullets
    player.bullets.forEach((b, j) => {
      if (Math.hypot(b.x - e.x, b.y - e.y) < 16) {
        e.life--;
        player.bullets.splice(j, 1);
        if (e.life <= 0) {
          score += 40;
          updateUI();
          spawnPowerUp(e.x, e.y);
          shooterEnemies.splice(i, 1);
        }
      }
    });
  });
}

/* ============================================================
   DRAW SHOOTER ENEMIES
   ============================================================ */

function drawShooterEnemies() {

  shooterEnemies.forEach(e => {

    ctx.fillStyle = "#f44336";
    ctx.fillRect(e.x - 10, e.y - 10, 20, 20);

    ctx.fillStyle = "#ff5252";
    e.bullets.forEach(b => {
      ctx.beginPath();
      ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
      ctx.fill();
    });
  });
}

/* ============================================================
   INTEGRAÃ‡ÃƒO FINAL
   ============================================================ */

const __update_part3 = update;
update = function(dt) {

  if (gameState === STATE.PLAYING) {
    updateShooterEnemies();
  }

  __update_part3(dt);
};

const __render_part3 = render;
render = function() {

  if (gameState === STATE.PLAYING) {
    drawShooterEnemies();
  }

  __render_part3();
};
</script>
